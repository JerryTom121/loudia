#! /usr/bin/env python
# encoding: utf-8
# Ricard Marxer 2008

import Options

LIBNAME = 'loudia'
LIBVERSION = '0.1-dev'

def set_options(opt):
	opt.tool_options('compiler_cxx')

        opt.sub_options('swig')
        opt.sub_options('tests')
	

def configure(conf):
	conf.check_tool('compiler_cxx')

        if conf.env['option_debug']:
                conf.env.append_value('CXXFLAGS', '-Wall  -O3 -fPIC -msse2 -DRICAUDIO_DEBUG')
        else:
                conf.env.append_value('CXXFLAGS', '-O3 -fPIC -msse2 -DNDEBUG')
                
        conf.env.append_value('LINKFLAGS', '-lfftw3f -lsamplerate')
        
        if not conf.env['option_no_python_bindings']:
                conf.sub_config('swig')

        if conf.env['option_cpptests']:
                conf.sub_config('tests')

def build(bld):
        obj = bld.new_task_gen(
                features = 'cxx cshlib',
                uselib = 'fftw3',
                target = LIBNAME,
                includes = '. /home/rmarxer/dev/eigen2',
                export_inc_dirs = '.',
                name         = LIBNAME,
                vnum         = LIBVERSION
        )
        
	obj.find_sources_in_dirs('.', exts=['.cpp'])

        if not bld.env['option_no_python_bindings']:
                bld.add_subdirs('swig')
        
        if bld.env['option_cpptests']:
                bld.add_subdirs('tests')
                
        bld.install_files('${PREFIX}/include/loudia', '*.h')
